From 8a592e4ead4ed6befe6044da3dd2dc7523c33905 Mon Sep 17 00:00:00 2001
From: Mingli Yu <Mingli.Yu@windriver.com>
Date: Fri, 16 Nov 2018 13:52:49 +0800
Subject: [PATCH] Makefile.in: remove _BUILD_STRING and _BUILD_TIME

Remove _BUILD_STRING and _BUILD_TIME to avoid
adding timestamp to _pl_bld.h which can result
in adding timestamp in library file such as
libnspr4.so.
 $ readelf --wide --decompress --hex-dump=.rodata libnspr4.so
 [snip]
  0x00004000 32303138 2d31312d 31352030 353a3439 2018-11-15 05:49
 [snip]

Upstream-Status: Pending

Signed-off-by: Mingli Yu <Mingli.Yu@windriver.com>
---
 lib/ds/Makefile.in        | 8 +-------
 lib/libc/src/Makefile.in  | 8 +-------
 lib/prstreams/Makefile.in | 8 +-------
 pr/src/Makefile.in        | 8 +-------
 4 files changed, 4 insertions(+), 28 deletions(-)

diff --git a/lib/ds/Makefile.in b/lib/ds/Makefile.in
index e737791..b578476 100644
--- a/lib/ds/Makefile.in
+++ b/lib/ds/Makefile.in
@@ -114,13 +114,7 @@ GARBAGE += $(TINC)
 
 $(TINC):
 	@$(MAKE_OBJDIR)
-	@$(ECHO) '#define _BUILD_STRING "$(SH_DATE)"' > $(TINC)
-	@if test ! -z "$(SH_NOW)"; then \
-	    $(ECHO) '#define _BUILD_TIME $(SH_NOW)$(SUF)' >> $(TINC); \
-	else \
-	    true; \
-	fi
-	@$(ECHO) '#define _PRODUCTION "$(PROD)"' >> $(TINC)
+	@$(ECHO) '#define _PRODUCTION "$(PROD)"' > $(TINC)
 
 
 $(OBJDIR)/plvrsion.$(OBJ_SUFFIX): plvrsion.c $(TINC)
diff --git a/lib/libc/src/Makefile.in b/lib/libc/src/Makefile.in
index e8a6d9f..978ed28 100644
--- a/lib/libc/src/Makefile.in
+++ b/lib/libc/src/Makefile.in
@@ -116,13 +116,7 @@ GARBAGE += $(TINC)
 
 $(TINC):
 	@$(MAKE_OBJDIR)
-	@$(ECHO) '#define _BUILD_STRING "$(SH_DATE)"' > $(TINC)
-	@if test ! -z "$(SH_NOW)"; then \
-	    $(ECHO) '#define _BUILD_TIME $(SH_NOW)$(SUF)' >> $(TINC); \
-	else \
-	    true; \
-	fi
-	@$(ECHO) '#define _PRODUCTION "$(PROD)"' >> $(TINC)
+	@$(ECHO) '#define _PRODUCTION "$(PROD)"' > $(TINC)
 
 
 $(OBJDIR)/plvrsion.$(OBJ_SUFFIX): plvrsion.c $(TINC)
diff --git a/lib/prstreams/Makefile.in b/lib/prstreams/Makefile.in
index aeb2944..f318097 100644
--- a/lib/prstreams/Makefile.in
+++ b/lib/prstreams/Makefile.in
@@ -116,13 +116,7 @@ endif
 
 $(TINC):
 	@$(MAKE_OBJDIR)
-	@$(ECHO) '#define _BUILD_STRING "$(SH_DATE)"' > $(TINC)
-	@if test ! -z "$(SH_NOW)"; then \
-	    $(ECHO) '#define _BUILD_TIME $(SH_NOW)$(SUF)' >> $(TINC); \
-	else \
-	    true; \
-	fi
-	@$(ECHO) '#define _PRODUCTION "$(PROD)"' >> $(TINC)
+	@$(ECHO) '#define _PRODUCTION "$(PROD)"' > $(TINC)
 
 
 $(OBJDIR)/plvrsion.$(OBJ_SUFFIX): plvrsion.c $(TINC)
diff --git a/pr/src/Makefile.in b/pr/src/Makefile.in
index 19c5a69..b4ac31c 100644
--- a/pr/src/Makefile.in
+++ b/pr/src/Makefile.in
@@ -326,13 +326,7 @@ GARBAGE += $(TINC)
 
 $(TINC):
 	@$(MAKE_OBJDIR)
-	@$(ECHO) '#define _BUILD_STRING "$(SH_DATE)"' > $(TINC)
-	@if test ! -z "$(SH_NOW)"; then \
-	    $(ECHO) '#define _BUILD_TIME $(SH_NOW)$(SUF)' >> $(TINC); \
-	else \
-	    true; \
-	fi
-	@$(ECHO) '#define _PRODUCTION "$(PROD)"' >> $(TINC)
+	@$(ECHO) '#define _PRODUCTION "$(PROD)"' > $(TINC)
 
 
 $(OBJDIR)/prvrsion.$(OBJ_SUFFIX): prvrsion.c $(TINC)
-- 
2.7.4

