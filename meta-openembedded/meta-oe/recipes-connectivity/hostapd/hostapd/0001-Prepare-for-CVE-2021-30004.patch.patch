From 14fab0772db19297c82dd1b8612c9335369dce41 Mon Sep 17 00:00:00 2001
From: Alexander Vickberg <wickbergster@gmail.com>
Date: Mon, 17 May 2021 17:54:13 +0200
Subject: [PATCH] Prepare for CVE-2021-30004.patch

Without this building fails for CONFIG_TLS=internal

Signed-off-by: Alexander Vickberg <wickbergster@gmail.com>
---
 src/tls/asn1.h       | 6 ++++++
 src/utils/includes.h | 1 +
 2 files changed, 7 insertions(+)

diff --git a/src/tls/asn1.h b/src/tls/asn1.h
index 6bd7df5..77b94ef 100644
--- a/src/tls/asn1.h
+++ b/src/tls/asn1.h
@@ -66,6 +66,12 @@ void asn1_oid_to_str(const struct asn1_oid *oid, char *buf, size_t len);
 unsigned long asn1_bit_string_to_long(const u8 *buf, size_t len);
 int asn1_oid_equal(const struct asn1_oid *a, const struct asn1_oid *b);
 
+static inline bool asn1_is_null(const struct asn1_hdr *hdr)
+{
+	return hdr->class == ASN1_CLASS_UNIVERSAL &&
+		hdr->tag == ASN1_TAG_NULL;
+}
+
 extern struct asn1_oid asn1_sha1_oid;
 extern struct asn1_oid asn1_sha256_oid;
 
diff --git a/src/utils/includes.h b/src/utils/includes.h
index 75513fc..741fc9c 100644
--- a/src/utils/includes.h
+++ b/src/utils/includes.h
@@ -18,6 +18,7 @@
 
 #include <stdlib.h>
 #include <stddef.h>
+#include <stdbool.h>
 #include <stdio.h>
 #include <stdarg.h>
 #include <string.h>
-- 
2.25.1

