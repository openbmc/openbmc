From 3af7272a3435fc79e5da729155480a346ccf2d44 Mon Sep 17 00:00:00 2001
From: Ross Burton <ross.burton@arm.com>
Date: Mon, 31 Jan 2022 17:40:13 +0000
Subject: [PATCH] strace: skip a number of load-sensitive tests

Skip tests which are known to be unreliable under load, typically because they
care about timing.

Upstream-Status: Inappropriate
Signed-off-by: Ross Burton <ross.burton@arm.com>
---
 tests/clock_nanosleep.gen.test | 1 +
 tests/delay.test               | 1 +
 tests/strace-r.test            | 1 +
 3 files changed, 3 insertions(+)

diff --git a/tests/clock_nanosleep.gen.test b/tests/clock_nanosleep.gen.test
index 7a6025b..f0e6dbb 100755
--- a/tests/clock_nanosleep.gen.test
+++ b/tests/clock_nanosleep.gen.test
@@ -1,4 +1,5 @@
 #!/bin/sh -efu
 # Generated by ./tests/gen_tests.sh from ./tests/gen_tests.in (clock_nanosleep -e trace=clock_nanosleep,clock_gettime); do not edit.
 . "${srcdir=.}/init.sh"
+skip_ "Test not reliable under load"
 run_strace_match_diff -e trace=clock_nanosleep,clock_gettime
diff --git a/tests/delay.test b/tests/delay.test
index f74e27f..6172c04 100755
--- a/tests/delay.test
+++ b/tests/delay.test
@@ -8,6 +8,7 @@
 # SPDX-License-Identifier: GPL-2.0-or-later
 
 . "${srcdir=.}/init.sh"
+skip_ "Test not reliable under load"
 
 while read -r denter dexit denter_us dexit_us; do
 	[ -n "$denter" ] || continue
diff --git a/tests/strace-r.test b/tests/strace-r.test
index 8299737..d89c7df 100755
--- a/tests/strace-r.test
+++ b/tests/strace-r.test
@@ -8,6 +8,7 @@
 # SPDX-License-Identifier: GPL-2.0-or-later
 
 . "${srcdir=.}/init.sh"
+skip_ "Test not reliable under load"
 
 r_opt="${1:--r}"
 
