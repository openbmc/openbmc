From 4588f4a0287787788eb86fb16f326cbaa7454e1d Mon Sep 17 00:00:00 2001
From: Zheng Junling <zhengjunling@huawei.com>
Date: Mon, 16 Jun 2014 12:51:25 +0000
Subject: [PATCH] slang: fix the iconv existence checking

When checking whether there is iconv, the configure file always check 
the host env.

Now we make it working properly by adding correct prefix for cross-
compiling environment.

When enabling iconv-module, we see a QA warning because rpaths hardcoded
into the build. And rpaths are not needed, so let's turn this off.

This patch is generated by referencing the existing "fix-check-pcre"
patch.

Upstream-Status: Inappropriate

Signed-off-by: Zheng Junling <zhengjunling@huawei.com>
---
 configure |   72 +++++---------------------------------------------------------
 1 file changed, 6 insertions(+), 66 deletions(-)

diff --git a/configure b/configure
index fa395ff..7fa769c 100755
--- a/configure
+++ b/configure
@@ -8259,6 +8259,7 @@ $as_echo_n "checking for the iconv library and header files ... " >&6; }
 	 /usr/include/iconv,/usr/lib \
 	 /usr/iconv/include,/usr/iconv/lib \
 	 /usr/include,/usr/lib \
+	 /usr/include,/usr/lib64 \
 	 /opt/include/iconv,/opt/lib \
 	 /opt/iconv/include,/opt/iconv/lib \
 	 /opt/include,/opt/lib"
@@ -8289,14 +8290,14 @@ $as_echo_n "checking for the iconv library and header files ... " >&6; }
         xincdir=`echo $include_and_lib | tr ',' ' ' | awk '{print $1}'`
 	xlibdir=`echo $include_and_lib | tr ',' ' ' | awk '{print $2}'`
 	found=0
-	if test -r $xincdir/$xincfile
+	if test -r $PKG_CONFIG_SYSROOT_DIR/$xincdir/$xincfile
 	then
 	  for E in $exts
 	  do
-	    if test -r "$xlibdir/$xlibfile.$E"
+	    if test -r "$PKG_CONFIG_SYSROOT_DIR/$xlibdir/$xlibfile.$E"
 	    then
-	      jd_iconv_include_dir="$xincdir"
-	      jd_iconv_library_dir="$xlibdir"
+	      jd_iconv_include_dir="$PKG_CONFIG_SYSROOT_DIR/$xincdir"
+	      jd_iconv_library_dir="$PKG_CONFIG_SYSROOT_DIR/$xlibdir"
 	      jd_with_iconv_library="yes"
 	      found=1
 	      break
@@ -8201,68 +8201,7 @@ $as_echo "yes: $jd_iconv_library_dir and $jd_iconv_include_dir" >&6; }
     then
       ICONV_LIB=""
     else
-
-if test "X$jd_iconv_library_dir" != "X"
-then
-  if test "X$RPATH" = "X"
-  then
-
-case "$host_os" in
-  *linux*|*solaris* )
-    if test "X$GCC" = Xyes
-    then
-      if test "X$ac_R_nospace" = "Xno"
-      then
-        RPATH="-Wl,-R,"
-      else
-        RPATH="-Wl,-R"
-      fi
-    else
-      if test "X$ac_R_nospace" = "Xno"
-      then
-        RPATH="-R "
-      else
-	RPATH="-R"
-      fi
-    fi
-  ;;
-  *osf*|*openbsd*|*freebsd*)
-    if test "X$GCC" = Xyes
-    then
-      RPATH="-Wl,-rpath,"
-    else
-      RPATH="-rpath "
-    fi
-  ;;
-  *netbsd*)
-    if test "X$GCC" = Xyes
-    then
-      RPATH="-Wl,-R"
-    fi
-  ;;
-esac
-
-    if test "X$RPATH" != "X"
-    then
-      RPATH="$RPATH$jd_iconv_library_dir"
-    fi
-  else
-    _already_there=0
-    for X in `echo $RPATH | sed 's/:/ /g'`
-    do
-      if test "$X" = "$jd_iconv_library_dir"
-      then
-        _already_there=1
-	break
-      fi
-    done
-    if test $_already_there = 0
-    then
-      RPATH="$RPATH:$jd_iconv_library_dir"
-    fi
-  fi
-fi
-
+      RPATH=""
     fi
 
     ICONV_INC=-I$jd_iconv_include_dir
