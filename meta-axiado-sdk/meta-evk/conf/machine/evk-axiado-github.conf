KERNEL_DEVICETREE = "axiado/ax3000-scm3003-evk-axiado.dtb"
KERNEL_DEVICETREE += "axiado/ax3000-scm3002-evk-axiado.dtb"
KERNEL_DEVICETREE += "axiado/ax3080-evk-axiado.dtb"

SOC_REVISION = "revA"

# Conditional assignments for different board revisions
UBOOT_MACHINE_revA = "ax3000_evk_defconfig"
UBOOT_MACHINE_revB = "ax3000b0_evk_defconfig"

# Dynamically set KBUILD_DEFCONFIG based on SOC_REVISION
UBOOT_MACHINE = "${UBOOT_MACHINE_${SOC_REVISION}}"

# Fallback to default if SOC_REVISION is not set or doesn't match
UBOOT_MACHINE ??= "ax3000_evk_defconfig"

BUILD_VAR ?= "dev"

require conf/machine/include/axiado.inc
require conf/machine/include/obmc-evb-common.inc

PREFERRED_VERSION_u-boot-axiado = "2019.04+git"
PREFERRED_VERSION_linux-axiado = "6.6.106+git"
PREFERRED_VERSION_sysproxy = "0.1"
PREFERRED_VERSION_tdfu = "0.1"
PREFERRED_VERSION_anx7688-axiado = "0.1"
PREFERRED_VERSION_eipdrv-axiado = "0.1"
PREFERRED_VERSION_klogmgr = "0.1"
PREFERRED_VERSION_shimfwl-axiado = "0.1"

FLASH_SIZE = "65535"
SERIAL_CONSOLES = "115200;ttyPS3"

OBMC_COMPATIBLE_NAMES = "ax3000"
EXTENDED_VERSION = "${DISTRO_VERSION}"

# Install Kernel modules
MACHINE_EXTRA_RRECOMMENDS = "kernel-modules"

IMAGE_FEATURES:remove = " \
    obmc-chassis-mgmt \
    obmc-chassis-state-mgmt \
    obmc-fan-control \
    obmc-fan-mgmt \
    obmc-host-ipmi \
    obmc-host-state-mgmt \
"

VIRTUAL-RUNTIME_obmc-inventory-manager = "entity-manager"
VIRTUAL-RUNTIME_obmc-sensors-hwmon = "dbus-sensors"

# Fix sysproxy build error
DEBUG_PREFIX_MAP:remove = "-fcanon-prefix-map"
